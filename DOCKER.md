# Docker Setup –¥–ª—è Triplan

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∑–∞–ø—É—Å–∫—É –ø—Ä–æ–µ–∫—Ç–∞ Triplan —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Docker –∏ docker-compose.

## üê≥ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```
triplan/
‚îú‚îÄ‚îÄ docker-compose.yml          # –ü—Ä–æ–¥–∞–∫—à–Ω –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ docker-compose.dev.yml      # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
‚îú‚îÄ‚îÄ .env.example               # –ü—Ä–∏–º–µ—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ nginx/
‚îÇ   ‚îî‚îÄ‚îÄ nginx.conf             # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Nginx
‚îú‚îÄ‚îÄ backend/
‚îÇ   ‚îî‚îÄ‚îÄ Dockerfile             # Dockerfile –¥–ª—è FastAPI backend
‚îî‚îÄ‚îÄ frontend/
    ‚îú‚îÄ‚îÄ Dockerfile             # Dockerfile –¥–ª—è Next.js (–ø—Ä–æ–¥–∞–∫—à–Ω)
    ‚îî‚îÄ‚îÄ Dockerfile.dev         # Dockerfile –¥–ª—è Next.js (—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞)
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã:
- Docker
- Docker Compose

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
cp .env.example .env

# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env —Ñ–∞–π–ª, —É—Å—Ç–∞–Ω–æ–≤–∏–≤ –≤–∞—à–∏ –∑–Ω–∞—á–µ–Ω–∏—è
# –û—Å–æ–±–µ–Ω–Ω–æ –≤–∞–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å SECRET_KEY –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
```

### 3. –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

```bash
# –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose up --build

# –ò–ª–∏ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
docker-compose up -d --build
```

–°–µ—Ä–≤–∏—Å—ã –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ –∞–¥—Ä–µ—Å–∞–º:
- **Frontend**: http://localhost:3000
- **Backend API**: http://localhost:8000
- **API Documentation**: http://localhost:8000/docs

### 4. –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

```bash
# –ó–∞–ø—É—Å–∫ —Å hot reload –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
docker-compose -f docker-compose.dev.yml up --build

# –ò–ª–∏ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
docker-compose -f docker-compose.dev.yml up -d --build
```

## üìã –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–æ–≤ –±–µ–∑ –∑–∞–ø—É—Å–∫–∞
docker-compose build

# –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose up

# –ó–∞–ø—É—Å–∫ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
docker-compose up -d

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose down

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å —É–¥–∞–ª–µ–Ω–∏–µ–º volumes
docker-compose down -v

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
docker-compose logs backend
docker-compose logs frontend
```

### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

```bash
# –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
docker-compose -f docker-compose.dev.yml up

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–µ–∂–∏–º–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
docker-compose -f docker-compose.dev.yml down

# –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
docker-compose build backend
docker-compose build frontend
```

### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥ –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker-compose exec backend bash
docker-compose exec frontend sh

# –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker-compose ps

# –ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤
docker stats
```

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ü—Ä–æ–¥–∞–∫—à–Ω —Ä–µ–∂–∏–º

```
[Client] ‚Üí [Nginx:80] ‚Üí [Frontend:3000]
                    ‚Üò   [Backend:8000]
```

- **Nginx** - reverse proxy, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã –∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é
- **Frontend** - Next.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ standalone —Ä–µ–∂–∏–º–µ
- **Backend** - FastAPI —Å–µ—Ä–≤–∏—Å —Å SQLite –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

### –†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

```
[Client] ‚Üí [Frontend:3000] ‚Üí [Backend:8000]
```

- **Frontend** - Next.js –≤ dev —Ä–µ–∂–∏–º–µ —Å hot reload
- **Backend** - FastAPI —Å hot reload

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

#### Backend
- `SECRET_KEY` - –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è JWT —Ç–æ–∫–µ–Ω–æ–≤
- `DB_PATH` - –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö SQLite
- `PYTHONPATH` - Python –ø—É—Ç—å (–æ–±—ã—á–Ω–æ /app)
- `PYTHONUNBUFFERED` - –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏–∏ Python –≤—ã–≤–æ–¥–∞

#### Frontend
- `NODE_ENV` - –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã (development/production)
- `NEXT_PUBLIC_API_URL` - URL backend API –¥–ª—è –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π —á–∞—Å—Ç–∏

### Volumes

- `triplan_data` - –ü–æ—Å—Ç–æ—è–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö SQLite
- `triplan_data_dev` - –•—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### Networks

- `triplan-network` - –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å–µ—Ç—å –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤
- `triplan-network-dev` - –°–µ—Ç—å –¥–ª—è —Ä–µ–∂–∏–º–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

```bash
# –í—Å–µ –ª–æ–≥–∏
docker-compose logs -f

# –õ–æ–≥–∏ backend
docker-compose logs -f backend

# –õ–æ–≥–∏ frontend  
docker-compose logs -f frontend

# –õ–æ–≥–∏ nginx (—Ç–æ–ª—å–∫–æ –≤ –ø—Ä–æ–¥–∞–∫—à–Ω–µ)
docker-compose logs -f nginx
```

### Health checks

Backend –∏–º–µ–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –∑–¥–æ—Ä–æ–≤—å—è:

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
curl http://localhost:8000/api/v1/health

# –ß–µ—Ä–µ–∑ Docker
docker-compose exec backend curl -f http://localhost:8000/api/v1/health
```

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º

```bash
# Backend (Python/bash)
docker-compose exec backend bash

# Frontend (Node/sh)
docker-compose exec frontend sh

# Nginx (—Ç–æ–ª—å–∫–æ –≤ –ø—Ä–æ–¥–∞–∫—à–Ω–µ)
docker-compose exec nginx sh
```

## üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

### –° Nginx (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# –ó–∞–ø—É—Å–∫ —Å Nginx reverse proxy
docker-compose --profile production up -d --build
```

### –ë–µ–∑ Nginx

```bash
# –ó–∞–ø—É—Å–∫ —Ç–æ–ª—å–∫–æ backend –∏ frontend
docker-compose up -d --build backend frontend
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSL

1. –ü–æ–º–µ—Å—Ç–∏—Ç–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –≤ `nginx/ssl/`
2. –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ HTTPS –±–ª–æ–∫ –≤ `nginx/nginx.conf`
3. –û–±–Ω–æ–≤–∏—Ç–µ –¥–æ–º–µ–Ω –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã

## üõ†Ô∏è –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

#### Backend
```bash
# –î–æ–±–∞–≤—å—Ç–µ –ø–∞–∫–µ—Ç –≤ requirements.txt
echo "new-package==1.0.0" >> backend/requirements.txt

# –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –æ–±—Ä–∞–∑
docker-compose build backend
```

#### Frontend
```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É
docker-compose exec frontend sh

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–∞–∫–µ—Ç
npm install new-package

# –ò–ª–∏ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏ –ø–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –æ–±—Ä–∞–∑
```

### –†–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

```bash
# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ backend –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É
docker-compose exec backend bash

# –ó–∞–ø—É—Å–∫ Python –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä–∞
python

# –†–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
>>> from database import SessionLocal, engine
>>> from sqlalchemy import text
>>> session = SessionLocal()
>>> result = session.execute(text("SELECT * FROM users"))
>>> print(result.fetchall())
```

## ‚ùó Troubleshooting

### –û–±—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **–ü–æ—Ä—Ç—ã –∑–∞–Ω—è—Ç—ã**
   ```bash
   # –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –∫–∞–∫–∏–µ –ø–æ—Ä—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è
   netstat -tulpn | grep :3000
   netstat -tulpn | grep :8000
   
   # –ò–∑–º–µ–Ω–∏—Ç–µ –ø–æ—Ä—Ç—ã –≤ docker-compose.yml –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
   ```

2. **–ü—Ä–æ–±–ª–µ–º—ã —Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è–º–∏**
   ```bash
   # –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Docker –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ —Ñ–∞–π–ª–∞–º
   sudo chown -R $USER:$USER .
   ```

3. **–û—à–∏–±–∫–∏ —Å–±–æ—Ä–∫–∏**
   ```bash
   # –û—á–∏—Å—Ç–∏—Ç–µ Docker –∫—ç—à
   docker system prune -a
   
   # –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –±–µ–∑ –∫—ç—à–∞
   docker-compose build --no-cache
   ```

4. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è**
   ```bash
   # –ü—Ä–æ–≤–µ—Ä—å—Ç–µ volume
   docker volume ls | grep triplan
   
   # –£–¥–∞–ª–∏—Ç–µ volume –∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–π—Ç–µ
   docker-compose down -v
   docker-compose up --build
   ```

### –õ–æ–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

```bash
# –ü–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏ Docker
docker-compose up --build --verbose

# –õ–æ–≥–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
docker-compose logs --tail=100 backend

# –°–ª–µ–¥–∏—Ç—å –∑–∞ –ª–æ–≥–∞–º–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
docker-compose logs -f --tail=0
```

---

**Triplan Docker Setup** - –≥–æ—Ç–æ–≤–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞! üê≥
