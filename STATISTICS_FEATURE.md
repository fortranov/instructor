# Статистика тренировок - Новая функциональность

## Обзор

Добавлена новая страница "Статистика" в приложение Triplan, которая отображает детальную аналитику выполнения планов тренировок пользователей.

## Основные возможности

### 1. Годовой график тренировок
- **Визуализация данных**: Столбчатый график, показывающий объемы тренировок по неделям
- **Два уровня данных**: 
  - Светлая часть столбца - запланированный объем тренировок
  - Темная часть столбца - выполненный объем тренировок
- **Адаптивность**: На десктопе показываются все 12 месяцев, на мобильных устройствах - первые 2 месяца

### 2. Переключение годов
- Возможность выбора года для просмотра статистики
- Автоматическое определение доступных годов на основе данных пользователя
- По умолчанию отображается текущий год

### 3. Общая статистика
- Общее время тренировок (запланировано/выполнено)
- Количество тренировок (запланировано/выполнено)
- Процент выполнения по времени и количеству тренировок

## Техническая реализация

### Backend (API)

#### Новые endpoints:
- `GET /api/v1/statistics/yearly/{year}` - получение годовой статистики
- `GET /api/v1/statistics/available-years` - получение доступных годов

#### Новые файлы:
- `backend/api_statistics.py` - API endpoints для статистики
- Обновлен `backend/schemas.py` - добавлены схемы для статистики
- Обновлен `backend/main.py` - подключен новый роутер

#### Схемы данных:
```python
class WeeklyStats(BaseModel):
    week_start: date
    week_end: date
    planned_duration: int  # в минутах
    completed_duration: int  # в минутах
    planned_workouts: int
    completed_workouts: int

class YearlyStatsResponse(BaseModel):
    year: int
    total_planned_duration: int
    total_completed_duration: int
    total_planned_workouts: int
    total_completed_workouts: int
    weekly_stats: List[WeeklyStats]
```

### Frontend

#### Новые файлы:
- `frontend/src/app/statistics/page.tsx` - страница статистики
- `frontend/src/components/yearly-chart.tsx` - компонент годового графика

#### Обновленные файлы:
- `frontend/src/components/navigation.tsx` - добавлена ссылка на статистику
- `frontend/src/lib/api.ts` - добавлены методы для работы со статистикой

#### Особенности реализации:
- Использование React hooks для управления состоянием
- Адаптивный дизайн с помощью Tailwind CSS
- Интеграция с существующей системой аутентификации
- Обработка ошибок и состояний загрузки

## Алгоритм группировки данных

### Недели
- Неделя начинается с понедельника и заканчивается воскресеньем
- Если 1 января не понедельник, первая неделя начинается с предыдущего понедельника
- Недели группируются по месяцам для отображения

### Статистика выполнения
- Запланированные тренировки берутся из плана пользователя
- Выполненные тренировки определяются по отметкам в таблице `WorkoutCompletionMark`
- Статистика рассчитывается в минутах для времени и в количестве для тренировок

## Использование

### Для пользователей:
1. Войдите в систему
2. Перейдите в раздел "Статистика" в главном меню
3. Выберите год для просмотра статистики
4. Изучите график и общую статистику

### Для разработчиков:
1. Backend API готов к использованию
2. Frontend компоненты можно переиспользовать
3. Схемы данных четко определены
4. Код хорошо документирован

## Возможные улучшения

1. **Дополнительные метрики**:
   - Статистика по типам тренировок
   - Средняя продолжительность тренировки
   - Тренды по месяцам

2. **Расширенная визуализация**:
   - Интерактивные графики
   - Детализация по неделям
   - Сравнение с предыдущими годами

3. **Экспорт данных**:
   - Экспорт в PDF
   - Экспорт в Excel/CSV
   - Поделиться статистикой

## Заключение

Функциональность статистики полностью интегрирована в существующее приложение и готова к использованию. Код следует принципам чистого кода, хорошо документирован и легко расширяется для будущих улучшений.
